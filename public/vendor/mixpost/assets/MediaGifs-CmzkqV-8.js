import{u as ce,C as h,G as A,S as Y,l as Z,aa as M,aT as ue,n as de,o as a,c as k,z as ee,e as p,g as j,aU as me,j as f,H as F,i as B,a7 as J,L as E,a5 as X,R as fe,m as V,a as d,W as ve,f as U,t as w,b as s,a9 as pe,w as o,F as P,A as ge,a6 as te,a8 as se,k as ae,h as le}from"./app-BxavtTYs.js";import{n as _e}from"./index.browser-DP16PUbO.js";import{_ as L}from"./Masonry-BYenGJi_.js";import{_ as G}from"./MediaFile-BY_fCad3.js";import{S as he}from"./SectionTitle-CXQlRiUw.js";import{_ as ne}from"./SearchInput-CkdofEcO.js";import{_ as oe}from"./NoResult-DNS5zprA.js";import{_ as re}from"./Alert-BlT5orGN.js";const q=(c="mixpost.media.fetchUploads",y={})=>{const{t:b}=ce(),{notify:C}=de(),v=h("uploads"),D=A(()=>["uploads","stock","gifs"]),r=h(!1),$=h(!1),g=h(!1),_=h(1),m=h([]),S=h(null),x=h(""),i=h([]),N=t=>{const e=i.value.findIndex(l=>l.id===t.id);e<0&&!t.hasOwnProperty("error")&&i.value.push(t),e>=0&&i.value.splice(e,1)},u=()=>{i.value=[]},I=t=>i.value.findIndex(l=>l.id===t.id)!==-1,n=(t=!0)=>{_.value&&(M.start(),axios.get(route(c,y),{params:{page:_.value,keyword:x.value}}).then(function(e){const l=e.data.links.next;l&&(_.value=e.data.links.next.split("?page=")[1]),l||(_.value=0),t||(m.value=e.data.data),t&&(m.value=[...m.value,...e.data.data])}).catch(()=>{C("error",b("media.error_retrieving_media"))}).finally(()=>{M.done(),r.value=!0}))},O=(t,e)=>{$.value=!0,M.start(),axios.post(route("mixpost.media.download",y),{items:t,from:v.value}).then(l=>{e(l)}).catch(()=>{C("error",b("media.error_downloading_media"))}).finally(()=>{$.value=!1,M.done(),M.remove()})},K=t=>{m.value=m.value.filter(e=>!t.includes(e.id))},T=t=>{let e="";return t.forEach(l=>{l.source==="Unsplash"&&(e+=`
Photo by ${l.author} on Unsplash`)}),e},R=(t,e)=>{g.value=!0,M.start(),axios.delete(route("mixpost.media.delete",y),{data:{items:t}}).then(()=>{e()}).catch(()=>{C("error",b("media.error_deleting_media"))}).finally(()=>{g.value=!1,M.done(),M.remove()})},z=()=>{const t=new IntersectionObserver(e=>{e[0].isIntersecting&&n()});ue(()=>{t.observe(S.value)})};return Y(x,Z.debounce(()=>{_.value=1,n(!1)},300)),{activeTab:v,tabs:D,isLoaded:r,isDownloading:$,isDeleting:g,keyword:x,page:_,items:m,endlessPagination:S,selected:i,getMediaCrediting:T,downloadExternal:O,deletePermanently:R,removeItems:K,createObserver:z,toggleSelect:N,deselectAll:u,isSelected:I}},H={__name:"MediaSelectable",props:{active:{type:Boolean,default:!1}},emits:["click"],setup(c){return(y,b)=>(a(),k("div",{onClick:b[0]||(b[0]=C=>y.$emit("click")),class:"w-full relative cursor-pointer box-border"},[ee(y.$slots,"default"),p("div",{class:F(["absolute flex items-center justify-center top-0 right-0 mr-md mt-md w-7 h-7 rounded-full border border-white",{"bg-primary-500":c.active,"bg-black bg-opacity-20":!c.active}])},[c.active?(a(),j(me,{key:0,class:"text-white"})):f("",!0)],2)]))}},ke={class:"relative flex flex-col justify-center"},ye={class:"text-center mb-1"},be={for:"browse",class:"cursor-pointer text-primary-500 hover:text-primary-700 active:text-primary-700 focus:outline-none focus:text-primary-700 transition-colors ease-in-out duration-200"},xe={class:"text-sm text-gray-400 text-center"},we=["accept"],$e={key:0,class:"mt-lg"},Se={__name:"UploadMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},selected:{type:Array,default:[]},toggleSelect:{type:Function},isSelected:{type:Function},columns:{type:Number,default:3}},emits:["mediaSelect"],setup(c,{emit:y}){const b=B("workspaceCtx"),C=c,v=J().props.mixpost.mime_types,D=h(null),r=h(!1),$=t=>{if(m.value)return;r.value=!1;const e=_(t.dataTransfer.files);e.length&&T(e)},g=t=>{const e=_(t.target.files);e.length&&(D.value.value=null,T(e))},_=t=>Array.from(t).filter(e=>v.includes(e.type)),m=h(!1),S=h([]),x=h([]),i=h({});Y(i,()=>{N(),m.value=Object.keys(i.value).length>0});const N=()=>{i.value.handler&&i.value.handler()},u=t=>{S.value.push(t),Object.keys(i.value).length===0&&I()},I=t=>{Object.keys(i.value).length>0&&(K(i.value,t),C.toggleSelect&&C.toggleSelect(t)),S.value.length>0?(n(S.value[0]),O()):n({})},n=t=>{i.value=t},O=()=>{S.value.shift()},K=(t,e)=>{x.value.push(Object.assign(t,{media:e}))},T=t=>{t.forEach(e=>{u({id:_e(),handler:async()=>{await R(e).then(l=>{I(l)}).catch(l=>{I({name:e.name,error:l.response.data.message})})}})})},R=t=>{const e=new FormData;return e.append("file",t),new Promise((l,Q)=>{axios.post(route("mixpost.media.upload",{workspace:b.id}),e).then(function(W){l(W.data)}).catch(function(W){Q(W)})})},z=A(()=>x.value.filter(()=>!0).reverse());return E(()=>{X.on("mediaDelete",t=>{x.value=x.value.filter(e=>!t.includes(e.media.id))})}),fe(()=>{X.off("mediaDelete")}),(t,e)=>(a(),k(P,null,[p("div",{onDragenter:e[2]||(e[2]=V(l=>r.value=!m.value,["prevent"])),onDrop:V($,["prevent"]),onDragover:e[3]||(e[3]=V(()=>{},["prevent"])),class:F([{"border-gray-700 bg-white":!r.value,"border-cyan-500 bg-cyan-50":r.value},"relative w-full flex items-center justify-center rounded-lg p-10 border-2 border-dashed transition-colors ease-in-out duration-200"])},[p("div",ke,[r.value?(a(),k("div",{key:0,onDragleave:e[0]||(e[0]=V(l=>r.value=!1,["prevent"])),onDragover:e[1]||(e[1]=V(()=>{},["prevent"])),class:"w-full h-full absolute"},null,32)):f("",!0),d(ve,{class:F([{"text-stone-700":!r.value,"text-cyan-500":r.value},"!w-16 !h-16 mx-auto mb-xs transition-colors ease-in-out duration-200"])},null,8,["class"]),p("div",ye,[U(w(t.$t("media.drag_drop_files"))+" ",1),p("label",be,w(t.$t("general.browse")),1)]),p("div",xe,w(s(v).join(", ")),1)]),m.value?(a(),j(pe,{key:0,size:"xl",class:"rounded-lg"})):f("",!0)],34),p("input",{ref_key:"input",ref:D,id:"browse",type:"file",accept:s(v).join(","),multiple:"multiple",class:"hidden",onChange:g},null,40,we),z.value.length?(a(),k("div",$e,[d(L,{items:z.value,columns:c.columns},{default:o(({item:l})=>[d(H,{active:c.isSelected(l.media),onClick:Q=>c.toggleSelect(l.media)},{default:o(()=>[d(G,{media:l.media},null,8,["media"])]),_:2},1032,["active","onClick"])]),_:1},8,["items","columns"])])):f("",!0)],64))}},Ge={__name:"MediaUploads",props:{columns:{type:Number,default:3}},setup(c,{expose:y}){const b=B("workspaceCtx"),{page:C,items:v,endlessPagination:D,selected:r,toggleSelect:$,deselectAll:g,removeItems:_,isSelected:m,createObserver:S}=q("mixpost.media.fetchUploads",{workspace:b.id});return E(()=>{S()}),y({selected:r,deselectAll:g,removeItems:_}),(x,i)=>(a(),k(P,null,[d(Se,{"max-selection":4,"combines-mime-types":"",selected:s(r),toggleSelect:s($),isSelected:s(m),columns:c.columns},null,8,["selected","toggleSelect","isSelected","columns"]),p("div",{class:F({"mt-lg":s(v).length})},[s(v).length?(a(),k(P,{key:0},[d(he,{class:"mb-4"},{default:o(()=>[U(w(x.$t("media.library")),1)]),_:1}),d(L,{items:s(v),columns:c.columns},{default:o(({item:N})=>[N?(a(),j(H,{key:0,active:s(m)(N),onClick:u=>s($)(N)},{default:o(()=>[d(G,{media:N},null,8,["media"])]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])],64)):f("",!0),p("div",{ref_key:"endlessPagination",ref:D,class:"-z-10 w-full"},null,512)],2)],64))}},Ce={},De={class:"absolute z-10 bottom-0 mb-xs left-0 ml-xs hidden group-hover:block shadow-mix"},Ne={class:"bg-white shadow-mix py-xs px-sm text-left rounded-md"};function Ie(c,y){return a(),k("div",De,[p("div",Ne,[ee(c.$slots,"default")])])}const ie=ge(Ce,[["render",Ie]]),Ue={key:0},je={key:0,class:"mt-lg"},Me=["href"],Pe=["href"],He={__name:"MediaStock",props:{columns:{type:Number,default:3}},setup(c,{expose:y}){const b=B("workspaceCtx"),{user:C}=te(),v=A(()=>Z.snakeCase(J().props.app.name)),D=A(()=>J().props.is_configured_service.unsplash),{isLoaded:r,keyword:$,items:g,endlessPagination:_,selected:m,toggleSelect:S,deselectAll:x,isSelected:i,createObserver:N}=q("mixpost.media.fetchStock",{workspace:b.id});return E(()=>{D.value&&N()}),y({selected:m,deselectAll:x}),(u,I)=>(a(),k(P,null,[D.value?(a(),k("div",Ue,[d(ne,{modelValue:s($),"onUpdate:modelValue":I[0]||(I[0]=n=>se($)?$.value=n:null),placeholder:u.$t("service.unsplash.search")},null,8,["modelValue","placeholder"]),s(g).length?(a(),k("div",je,[d(L,{items:s(g),columns:c.columns},{default:o(({item:n})=>[n?(a(),j(H,{key:0,active:s(i)(n),onClick:O=>s(S)(n)},{default:o(()=>[d(G,{media:n,class:"group"},{default:o(()=>[d(ie,null,{default:o(()=>[p("div",null,[U(w(u.$t("media.image_source"))+": ",1),p("a",{href:`https://unsplash.com/?utm_source=${v.value}&utm_medium=referral`,target:"_blank",class:"link"},"Unsplash",8,Me)]),p("div",null,[U(w(u.$t("media.author"))+": ",1),p("a",{href:`${n.credit_url}?utm_source=${v.value}&utm_medium=referral`,target:"_blank",class:"link"},w(n.name),9,Pe)])]),_:2},1024)]),_:2},1032,["media"])]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])])):f("",!0),s(r)&&!s(g).length?(a(),j(oe,{key:1,class:"mt-lg"},{default:o(()=>[U(w(u.$t("media.no_images_found")),1)]),_:1})):f("",!0),p("div",{ref_key:"endlessPagination",ref:_,class:"-z-10 w-full"},null,512)])):f("",!0),D.value?f("",!0):(a(),k(P,{key:1},[d(re,{variant:"warning",closeable:!1},{default:o(()=>[U(w(u.$t("service.not_configured_service",{service:"Unsplash"})),1)]),_:1}),s(C).is_admin?(a(),j(s(le),{key:0,href:u.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[d(ae,null,{default:o(()=>[U(w(u.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):f("",!0)],64))],64))}},Oe={key:0},Ve={key:0,class:"mt-lg"},Ke={__name:"MediaGifs",props:{columns:{type:Number,default:3}},setup(c,{expose:y}){const b=B("workspaceCtx"),{user:C}=te(),v=A(()=>J().props.is_configured_service.tenor),{isLoaded:D,keyword:r,page:$,items:g,endlessPagination:_,selected:m,toggleSelect:S,deselectAll:x,isSelected:i,createObserver:N}=q("mixpost.media.fetchGifs",{workspace:b.id});return E(()=>{v.value&&N()}),y({selected:m,deselectAll:x}),(u,I)=>(a(),k(P,null,[v.value?(a(),k("div",Oe,[d(ne,{modelValue:s(r),"onUpdate:modelValue":I[0]||(I[0]=n=>se(r)?r.value=n:null),placeholder:u.$t("service.tenor.search_gifs")},null,8,["modelValue","placeholder"]),s(g).length?(a(),k("div",Ve,[d(L,{items:s(g),columns:c.columns},{default:o(({item:n})=>[n?(a(),j(H,{key:0,active:s(i)(n),onClick:O=>s(S)(n)},{default:o(()=>[(a(),j(G,{media:n,key:n.id,class:"group"},{default:o(()=>[d(ie,null,{default:o(()=>[U(w(u.$t("service.tenor.gif")),1)]),_:1})]),_:2},1032,["media"]))]),_:2},1032,["active","onClick"])):f("",!0)]),_:1},8,["items","columns"])])):f("",!0),s(D)&&!s(g).length?(a(),j(oe,{key:1,class:"mt-lg"},{default:o(()=>[U(w(u.$t("media.no_gifs_found")),1)]),_:1})):f("",!0),p("div",{ref_key:"endlessPagination",ref:_,class:"-z-10 w-full"},null,512)])):f("",!0),v.value?f("",!0):(a(),k(P,{key:1},[d(re,{variant:"warning",closeable:!1},{default:o(()=>[U(w(u.$t("service.not_configured_service",{service:"Tenor"})),1)]),_:1}),s(C).is_admin?(a(),j(s(le),{key:0,href:u.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[d(ae,null,{default:o(()=>[U(w(u.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):f("",!0)],64))],64))}};export{Ge as _,He as a,Ke as b,q as u};
